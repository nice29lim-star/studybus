<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ìŠ¤í„°ë””ë²„ìŠ¤: í†µí•© ì†”ë£¨ì…˜</title>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;900&family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    
    <style>
        /* =========================================
           [ê³µí†µ ë° ìŠ¤í† ë¦¬ ëª¨ë“œ ìŠ¤íƒ€ì¼ (Scene 0~5)] 
           ========================================= */
        #bg-1 { background-image: url('checkin.png'); }
        #bg-2 { background-image: url('docking.png'); }
        #bg-3-static { background-image: url('qr.png'); }
        #bg-4 { background-image: url('crisis.png'); }
        #bg-5-space { background-image: url('planet_bg.png'); }
        #intro-thumbnail-layer { background-image: url('thumbnail.png'); background-color: #000; }

        :root {
            --primary-neon: #00f0ff;
            --alert-color: #ff3366;
            --current-theme: #00f0ff;
            
            /* ì½˜ì†”ìš© ê¸°ë³¸ ë””ìì¸ ë³€ìˆ˜ */
            --hud-bg: #050a14;
            --hud-panel: rgba(20, 30, 50, 0.85);
            --hud-border: #00f0ff;
            --hud-text: #e0faff;
            --hud-grid: rgba(0, 240, 255, 0.07);
            --hud-dim: rgba(0, 240, 255, 0.2);

            /* í–‰ì„±ë³„ í…Œë§ˆ ì»¬ëŸ¬ ë³€ìˆ˜ (Scene 5ìš©) */
            --theme-smart: #4a90e2;
            --theme-time: #f1c40f;
            --theme-grit: #e74c3c;
            --theme-motiva: #2ecc71;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { width: 100%; height: 100%; overflow: hidden; font-family: 'Noto Sans KR', sans-serif; background-color: #000; color: #fff; }
        #app-container { width: 100%; height: 100%; position: relative; }

        /* [ìƒë‹¨ ì¸í„°í˜ì´ìŠ¤] */
        .top-interface {
            position: absolute; top: 0; left: 0; width: 100%; height: 80px;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 30px; z-index: 100; pointer-events: none;
            transition: opacity 0.5s; opacity: 0;
        }
        .top-interface.visible { opacity: 1; }
        .top-interface > * { pointer-events: auto; }

        .top-left-group { display: flex; align-items: center; gap: 20px; }
        .menu-btn {
            font-size: 2rem; cursor: pointer; color: #fff; background: none; border: none;
            text-shadow: 0 0 5px var(--current-theme); transition: color 0.3s;
        }
        .menu-btn:hover { color: var(--current-theme); }

        .scene-title-display {
            font-family: 'Orbitron', sans-serif; font-size: 1.2rem; font-weight: bold;
            color: rgba(255,255,255,0.8); border-left: 2px solid #555; padding-left: 15px;
        }

        .nav-btn {
            width: 120px; height: 50px; border: none; border-radius: 8px;
            font-size: 1rem; font-weight: bold; cursor: pointer; color: white;
            box-shadow: 0 4px 6px rgba(0,0,0,0.5); transition: all 0.2s;
        }
        .btn-prev { background-color: rgba(50, 50, 50, 0.8); border: 1px solid #777; }
        .btn-next { background-color: var(--current-theme); color: #000; font-family: 'Orbitron'; font-weight: 900; }
        
        /* [ì‚¬ì´ë“œ ë©”ë‰´] */
        #side-menu-overlay {
            position: fixed; top: 0; left: -350px; width: 320px; height: 100%;
            background: rgba(10, 10, 15, 0.95); border-right: 1px solid var(--current-theme);
            z-index: 2000; transition: left 0.3s ease;
            backdrop-filter: blur(10px); display: flex; flex-direction: column; padding: 20px;
            box-shadow: 5px 0 20px rgba(0,0,0,0.5);
        }
        #side-menu-overlay.active { left: 0; }
        
        .menu-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; border-bottom: 1px solid #333; padding-bottom: 15px; }
        .menu-title { font-family: 'Orbitron'; font-size: 1.5rem; color: var(--current-theme); }
        .close-menu-btn { background: none; border: none; color: #fff; font-size: 1.5rem; cursor: pointer; }

        .menu-list { list-style: none; padding: 0; }
        .menu-item { margin-bottom: 15px; }
        .menu-link { 
            display: block; padding: 10px 15px; color: #ccc; text-decoration: none; font-size: 1.1rem; 
            border-radius: 5px; transition: 0.2s; cursor: pointer;
        }
        .menu-link:hover { background: rgba(255,255,255,0.1); color: var(--current-theme); padding-left: 20px; }

        .settings-area { margin-top: auto; border-top: 1px solid #333; padding-top: 20px; }
        .setting-row { margin-bottom: 15px; }
        .setting-label { display: block; margin-bottom: 5px; font-size: 0.9rem; color: #aaa; }
        .volume-slider { width: 100%; cursor: pointer; accent-color: var(--current-theme); }

        .hidden { display: none !important; }

        /* [Scene ê³µí†µ] */
        .scene {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: none; flex-direction: column; justify-content: flex-end;
            overflow: hidden; opacity: 0; transition: opacity 0.5s ease-in-out;
        }
        .scene.active { display: flex; opacity: 1; animation: fadeIn 0.8s ease-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .bg-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; z-index: 0; }
        .bg-layer-static { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center; z-index: 0; transform: scale(1); }

        /* [Scene 0: ì¸íŠ¸ë¡œ] */
        #scene-0-intro { justify-content: center; align-items: center; background-color: #000; }
        #intro-thumbnail-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-size: cover; background-position: center;
            z-index: 5; display: flex; flex-direction: column; justify-content: center; align-items: center;
            transition: opacity 0.8s;
        }
        .thumb-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); z-index: -1; }
        .intro-main-title { 
            font-family: 'Orbitron', sans-serif; font-size: 5rem; font-weight: 900; color: #fff; margin: 0; letter-spacing: 5px;
            text-shadow: 0 0 10px var(--primary-neon), 0 0 40px var(--alert-color);
            text-align: center; margin-bottom: 40px;
        }
        .start-mission-btn {
            padding: 20px 60px; font-size: 1.8rem; font-family: 'Orbitron', sans-serif; font-weight: 900;
            color: #050510; background: var(--primary-neon); border: none; border-radius: 5px; cursor: pointer;
            box-shadow: 0 0 20px var(--primary-neon); animation: pulseBtn 2s infinite;
        }
        @keyframes pulseBtn { 0%, 100% { box-shadow: 0 0 20px var(--primary-neon); } 50% { box-shadow: 0 0 40px var(--primary-neon); } }
        #intro-video-layer { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; display: none; background: #000; }
        #intro-video { width: 100%; height: 100%; object-fit: contain; }

        /* [ëŒ€í™”ì°½ ìŠ¤íƒ€ì¼] */
        .dialogue-container {
            width: 100%; height: 35%;
            background: linear-gradient(to bottom, rgba(0, 10, 20, 0.6), rgba(0, 0, 0, 0.85));
            backdrop-filter: blur(5px); 
            border-top: 4px solid var(--current-theme);
            padding: 40px 50px; 
            display: flex; flex-direction: column; justify-content: flex-start;
            z-index: 20; position: relative;
            box-shadow: 0 -10px 40px rgba(0,0,0,0.5);
        }
        .speaker-name { 
            font-size: 2.2rem; font-weight: 900; margin-bottom: 20px; 
            text-shadow: 0 0 10px currentColor; font-family: 'Noto Sans KR', sans-serif;
            letter-spacing: 2px; transition: color 0.2s;
        }
        .dialogue-text { 
            font-size: 2.2rem; line-height: 1.5; white-space: pre-wrap; 
            font-weight: 600; color: #fff; text-shadow: 0 2px 4px rgba(0,0,0,0.8); 
        }
        .cursor { display: inline-block; width: 5px; height: 1.2em; background-color: var(--current-theme); animation: blink 1s infinite; margin-left: 5px; vertical-align: sub;}
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0; } }
        .next-indicator { position: absolute; bottom: 30px; right: 40px; color: var(--current-theme); font-size: 2rem; animation: bounce 1s infinite; display: none; cursor: pointer;}
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(10px); } }

        /* ê±´ë„ˆë›°ê¸° ë²„íŠ¼ */
        .skip-btn {
            position: absolute; top: 20px; right: 30px;
            background: rgba(255, 255, 255, 0.1); border: 1px solid rgba(255,255,255,0.3);
            color: #aaa; padding: 5px 15px; border-radius: 20px; cursor: pointer;
            font-size: 0.9rem; transition: 0.2s;
        }
        .skip-btn:hover { background: rgba(255, 255, 255, 0.2); color: #fff; border-color: #fff; }

        /* [Scene 4 íƒœë¸”ë¦¿] */
        .tablet-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 80%; pointer-events: none; z-index: 15; padding-top: 16%; padding-left: 28%; }
        .cmd-text { font-family: 'Courier New', monospace; color: #0f0; font-size: 1.2rem; font-weight: bold; text-shadow: 0 0 5px rgba(0, 255, 0, 0.8); line-height: 1.6; }

        /* =========================================
           [Scene 5: í–‰ì„± ì§€ë„ (ë ˆí¼ëŸ°ìŠ¤ ìŠ¤íƒ€ì¼ ì ìš©)]
           ========================================= */
        #scene-5-map {
            justify-content: center; align-items: center;
        }
        #space-effects { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 10; pointer-events: none; }
        
        .star { position: absolute; border-radius: 50%; background-color: #fff; box-shadow: 0 0 10px 2px var(--star-color); }
        @keyframes realistic-pulse-slow { 0% { opacity: 0.4; transform: scale(0.9); box-shadow: 0 0 5px 1px var(--star-color); } 70% { opacity: 1; transform: scale(1.3); box-shadow: 0 0 5px 1px #fff, 0 0 20px 5px var(--star-color); } 100% { opacity: 0.4; transform: scale(0.9); box-shadow: 0 0 5px 1px var(--star-color); } }

        /* í–‰ì„± ì„ íƒ ê·¸ë¦¬ë“œ ì»¨í…Œì´ë„ˆ */
        .planet-selection-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 30px;
            width: 90%;
            max-width: 1400px;
            height: 70%;
            z-index: 20;
            padding: 20px;
        }

        /* ê°œë³„ í–‰ì„± ì¹´ë“œ (ë ˆí¼ëŸ°ìŠ¤ ìŠ¤íƒ€ì¼) */
        .planet-card {
            position: relative;
            background: rgba(10, 15, 25, 0.85);
            border: 2px solid rgba(255, 255, 255, 0.1);
            /* í•˜ë‹¨ì´ ê¹ì¸ SF ìŠ¤íƒ€ì¼ í…Œë‘ë¦¬ êµ¬í˜„ */
            clip-path: polygon(
                0 0, 
                100% 0, 
                100% calc(100% - 30px), 
                calc(100% - 30px) 100%, 
                0 100%
            );
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
        }

        /* ì¹´ë“œ í˜¸ë²„ íš¨ê³¼ */
        .planet-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        /* í…Œë§ˆë³„ í˜¸ë²„ í…Œë‘ë¦¬ ìƒ‰ìƒ */
        .planet-card.smart:hover { border-color: var(--theme-smart); box-shadow: 0 0 30px var(--theme-smart); }
        .planet-card.time:hover { border-color: var(--theme-time); box-shadow: 0 0 30px var(--theme-time); }
        .planet-card.grit:hover { border-color: var(--theme-grit); box-shadow: 0 0 30px var(--theme-grit); }
        .planet-card.motiva:hover { border-color: var(--theme-motiva); box-shadow: 0 0 30px var(--theme-motiva); }

        /* ì¹´ë“œ ë°°ê²½ (ë¹ŒëŸ° ì´ë¯¸ì§€) */
        .card-bg-villain {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%; /* ì „ì²´ë¥¼ ì±„ìš°ë˜ ê·¸ë¼ë°ì´ì…˜ìœ¼ë¡œ í•˜ë‹¨ì„ ê°€ë¦¼ */
            background-size: cover;
            background-position: top center;
            z-index: 0;
            transition: transform 0.5s ease;
        }
        /* ë°°ê²½ ì´ë¯¸ì§€ í•˜ë‹¨ ê·¸ë¼ë°ì´ì…˜ ì˜¤ë²„ë ˆì´ (í•˜ë°˜ì‹  íë¦¬ê²Œ ì²˜ë¦¬) */
        .card-bg-villain::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 60%; /* í•˜ë‹¨ 60% ì˜ì—­ì— ê·¸ë¼ë°ì´ì…˜ ì ìš© */
            background: linear-gradient(to bottom, transparent 0%, rgba(10, 15, 25, 0.9) 60%, rgba(10, 15, 25, 1) 100%);
        }
        .planet-card:hover .card-bg-villain {
            transform: scale(1.05);
        }

        /* â˜…â˜…â˜… [ì¤‘ìš”] ë¹ŒëŸ° ì´ë¯¸ì§€ ë§¤í•‘ ë¶€ë¶„ â˜…â˜…â˜… */
        .bg-smart { background-image: url('villain_smart.png'); }
        .bg-time { background-image: url('villain_time.png'); }
        .bg-grit { background-image: url('villain_grit.png'); }
        .bg-motiva { background-image: url('villain_motiva.png'); }

        /* ì¤‘ì•™ í–‰ì„± ë§ˆí¬ */
        .card-mark {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 120px;
            height: 120px;
            z-index: 2;
            object-fit: contain;
            transition: all 0.3s ease;
        }
        /* ë§ˆí¬ ë„¤ì˜¨ ë°œê´‘ íš¨ê³¼ */
        .mark-smart { filter: drop-shadow(0 0 15px var(--theme-smart)) drop-shadow(0 0 30px var(--theme-smart)); }
        .mark-time { filter: drop-shadow(0 0 15px var(--theme-time)) drop-shadow(0 0 30px var(--theme-time)); }
        .mark-grit { filter: drop-shadow(0 0 15px var(--theme-grit)) drop-shadow(0 0 30px var(--theme-grit)); }
        .mark-motiva { filter: drop-shadow(0 0 15px var(--theme-motiva)) drop-shadow(0 0 30px var(--theme-motiva)); }
        
        .planet-card:hover .card-mark {
            transform: translate(-50%, -50%) scale(1.1);
            filter: drop-shadow(0 0 25px currentColor) drop-shadow(0 0 50px currentColor);
        }

        /* ì¹´ë“œ í•˜ë‹¨ ì½˜í…ì¸  (í…ìŠ¤íŠ¸ ë° ë²„íŠ¼) */
        .card-content {
            position: relative;
            z-index: 3;
            padding: 25px;
            /* í…ìŠ¤íŠ¸ ê°€ë…ì„±ì„ ìœ„í•œ ì€ì€í•œ ë°°ê²½ */
            background: linear-gradient(to bottom, transparent, rgba(0,0,0,0.9));
            height: 35%;
            display: flex;
            flex-direction: column;
            justify-content: flex-end; /* í…ìŠ¤íŠ¸ë¥¼ ë°”ë‹¥ì— ë¶™ì„ */
            gap: 15px;
        }

        .card-title {
            font-family: 'Orbitron', sans-serif;
            font-size: 2rem;
            font-weight: 900;
            margin-bottom: 5px;
            text-transform: uppercase;
            letter-spacing: 1px;
            line-height: 1.1;
        }
        /* í…Œë§ˆë³„ íƒ€ì´í‹€ ìƒ‰ìƒ */
        .title-smart { color: var(--theme-smart); text-shadow: 0 0 10px var(--theme-smart); }
        .title-time { color: var(--theme-time); text-shadow: 0 0 10px var(--theme-time); }
        .title-grit { color: var(--theme-grit); text-shadow: 0 0 10px var(--theme-grit); }
        .title-motiva { color: var(--theme-motiva); text-shadow: 0 0 10px var(--theme-motiva); }

        .card-desc {
            font-size: 1rem;
            color: #ccc;
            line-height: 1.4;
            word-break: keep-all;
        }

        .enter-btn-wrap {
            display: flex;
            justify-content: flex-end;
            margin-top: 10px;
        }

        .enter-btn {
            font-family: 'Orbitron', sans-serif;
            font-size: 1.1rem;
            font-weight: bold;
            color: #777;
            background: none;
            border: none;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
        }
        /* í…Œë§ˆë³„ ë²„íŠ¼ í˜¸ë²„ ìƒ‰ìƒ */
        .planet-card.smart:hover .enter-btn { color: var(--theme-smart); text-shadow: 0 0 10px var(--theme-smart); }
        .planet-card.time:hover .enter-btn { color: var(--theme-time); text-shadow: 0 0 10px var(--theme-time); }
        .planet-card.grit:hover .enter-btn { color: var(--theme-grit); text-shadow: 0 0 10px var(--theme-grit); }
        .planet-card.motiva:hover .enter-btn { color: var(--theme-motiva); text-shadow: 0 0 10px var(--theme-motiva); }

        .enter-btn::after {
            content: '>';
            margin-left: 5px;
            transition: transform 0.3s;
        }
        .planet-card:hover .enter-btn::after {
            transform: translateX(5px);
        }

        /* ë°˜ì‘í˜• ë¯¸ë””ì–´ ì¿¼ë¦¬ */
        @media (max-width: 1200px) {
            .planet-selection-grid {
                grid-template-columns: repeat(2, 1fr); /* 2ì—´ë¡œ ë³€ê²½ */
                height: auto;
                gap: 20px;
            }
            .planet-card { height: 450px; } /* ì¹´ë“œ ë†’ì´ ê³ ì • */
            #scene-5-map { overflow-y: auto; align-items: flex-start; padding-top: 100px; }
        }
        @media (max-width: 768px) {
            .planet-selection-grid {
                grid-template-columns: 1fr; /* 1ì—´ë¡œ ë³€ê²½ */
                width: 95%;
            }
            .planet-card { height: 400px; }
            .card-title { font-size: 1.8rem; }
            .card-desc { font-size: 0.9rem; }
        }


        /* [Scene 5 ëª¨ë‹¬] */
        #planet-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 200; display: none; justify-content: center; align-items: center; backdrop-filter: blur(5px); }
        .pm-content { 
            background: linear-gradient(145deg, #1a1a2e, #0f1020); 
            border: 4px solid #fff; border-radius: 20px; padding: 40px; width: 700px; text-align: center; 
            animation: modalPulse 2s infinite ease-in-out;
        }
        @keyframes modalPulse {
            0% { box-shadow: 0 0 20px var(--p-color); }
            50% { box-shadow: 0 0 50px var(--p-color); }
            100% { box-shadow: 0 0 20px var(--p-color); }
        }
        .pm-title { font-size: 2.5rem; margin-bottom: 20px; font-weight: 900; }
        .pm-desc { font-size: 1.5rem; margin-bottom: 40px; color: #eee; word-break: keep-all; line-height: 1.6; }
        .pm-buttons { display: flex; justify-content: center; gap: 20px; }
        .pm-btn { padding: 15px 50px; font-size: 1.4rem; border-radius: 10px; cursor: pointer; border: none; font-weight: bold; }
        .pm-btn-cancel { background: #555; color: #fff; }

        /* =========================================
           [Scene 6: ê°•ì‚¬ ì‘ì „ ì½˜ì†” (HUD ìŠ¤íƒ€ì¼)]
           ========================================= */
        #scene-6-console {
            background-color: var(--hud-bg);
            display: none; 
            flex-direction: column;
            width: 100%; height: 100%;
            /* SF Grid Background Pattern */
            background-image: 
                linear-gradient(var(--hud-grid) 1px, transparent 1px),
                linear-gradient(90deg, var(--hud-grid) 1px, transparent 1px);
            background-size: 50px 50px;
        }
        #scene-6-console.active { display: flex; }

        /* ìƒë‹¨ í—¤ë” HUD */
        .hud-header {
            flex: 0 0 80px; display: grid; grid-template-columns: 1fr auto 1fr; align-items: center;
            padding: 0 30px; border-bottom: 2px solid var(--hud-border);
            background: linear-gradient(180deg, rgba(0,40,60,0.9), rgba(0,10,20,0.95));
            box-shadow: 0 0 20px var(--hud-dim);
            z-index: 500;
        }
        
        /* í—¤ë” ì¢Œì¸¡ */
        .hud-header-left { display: flex; align-items: center; gap: 15px; }
        .hud-title {
            font-family: 'Orbitron'; font-size: 1.5rem; letter-spacing: 2px;
            color: var(--hud-border); text-shadow: 0 0 10px var(--hud-border);
        }

        /* í—¤ë” ì¤‘ì•™ (íƒ­ ë²„íŠ¼) */
        .hud-header-center { display: flex; gap: 20px; }
        .hud-tab-btn {
            background: transparent; border: 1px solid #444; color: #777;
            padding: 10px 30px; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            border-radius: 4px; transition: 0.3s;
            clip-path: polygon(10px 0, 100% 0, 100% calc(100% - 10px), calc(100% - 10px) 100%, 0 100%, 0 10px);
        }
        .hud-tab-btn:hover { border-color: #fff; color: #fff; }
        .hud-tab-btn.active {
            background: rgba(0, 240, 255, 0.15); border-color: var(--hud-border); color: #fff;
            box-shadow: 0 0 15px var(--hud-dim);
        }

        /* í—¤ë” ìš°ì¸¡ */
        .hud-header-right { display: flex; justify-content: flex-end; }
        .hud-btn {
            background: transparent; border: 1px solid var(--hud-border); color: var(--hud-border);
            padding: 10px 25px; font-family: 'Orbitron'; font-size: 1rem; cursor: pointer;
            transition: 0.3s; clip-path: polygon(10% 0, 100% 0, 100% 80%, 90% 100%, 0 100%, 0 20%);
        }
        .hud-btn:hover { background: var(--hud-dim); box-shadow: 0 0 15px var(--hud-dim); }

        /* ë©”ì¸ ë°”ë”” */
        .hud-body { 
            flex: 1; display: flex; overflow: hidden;
        }
        
        /* ì¢Œì¸¡: ë¹ŒëŸ° ì´ë¯¸ì§€ íŒ¨ë„ */
        .hud-left-panel {
            flex: 0 0 30%; border-right: 1px solid var(--hud-grid);
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: linear-gradient(90deg, rgba(0,0,0,0.5), transparent);
            position: relative;
        }
        .model-box {
            width: 95%; height: 90%; 
            border: 2px solid var(--alert-color); 
            border-radius: 20px;
            box-shadow: 0 0 30px rgba(255, 51, 102, 0.2);
            position: relative; overflow: hidden;
            background: radial-gradient(circle at center, #1a0505 0%, #000 100%);
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        
        /* [ë¹ŒëŸ°ë³„ ê°œë³„ ì½”ë“œ ë¶„ë¦¬] */
        .villain-img {
            width: 100%; height: 100%;
            object-fit: contain;
            filter: drop-shadow(0 0 20px rgba(255, 51, 102, 0.6));
        }

        /* 1. ìŠ¤ë§ˆíŠ¸ í”Œë˜ë‹› (ìš¸íŠ¸ë¡ ) */
        .villain-smart {
            animation: floatSmart 3s ease-in-out infinite;
        }
        @keyframes floatSmart {
            0% { transform: translateY(0px) scale(1.0); }
            50% { transform: translateY(-15px) scale(1.0); }
            100% { transform: translateY(0px) scale(1.0); }
        }

        /* 2. íƒ€ì„ í”Œë˜ë‹› (ë”œë ˆì´ì–´) */
        .villain-time {
            animation: floatTime 3s ease-in-out infinite;
        }
        @keyframes floatTime {
            0% { transform: translateY(0px) scale(1.0); }
            50% { transform: translateY(-15px) scale(1.0); }
            100% { transform: translateY(0px) scale(1.0); }
        }

        /* 3. ê·¸ë¦¿ í”Œë˜ë‹› (ì‡¼íŠ¸ì»¤í„°) */
        .villain-grit {
            animation: floatGrit 3s ease-in-out infinite;
        }
        @keyframes floatGrit {
            0% { transform: translateY(0px) scale(1.0); }
            50% { transform: translateY(-15px) scale(1.0); }
            100% { transform: translateY(0px) scale(1.0); }
        }

        /* 4. ëª¨í‹°ë°” í”Œë˜ë‹› (ë¸”ë­ì»¤) */
        .villain-motiva {
            animation: floatMotiva 3s ease-in-out infinite;
        }
        @keyframes floatMotiva {
            0% { transform: translateY(0px) scale(1.0); }
            50% { transform: translateY(-15px) scale(1.0); }
            100% { transform: translateY(0px) scale(1.0); }
        }

        .model-label {
            position: absolute; bottom: 20px; left: 50%; transform: translateX(-50%);
            color: var(--alert-color); font-family: 'Orbitron'; letter-spacing: 3px;
            font-size: 2.5rem; 
            text-shadow: 0 0 10px var(--alert-color); animation: blink 2s infinite; pointer-events: none;
            width: 100%; text-align: center;
        }

        /* ìš°ì¸¡: íŒ€ ê·¸ë¦¬ë“œ ì˜ì—­ */
        .hud-right-panel {
            flex: 1; overflow-y: auto; padding: 20px 40px;
            display: flex; justify-content: center; align-items: center;
        }
        
        /* íŒ€ ê·¸ë¦¬ë“œ (2ì—´ 3í–‰) */
        .hud-team-grid {
            display: grid; grid-template-columns: 1fr 1fr; grid-template-rows: repeat(3, 1fr);
            gap: 20px; width: 100%; height: 95%; max-width: 1400px;
        }

        /* ì¹´ë“œ ë””ìì¸ */
        .hud-card {
            background: var(--hud-panel); border: 1px solid rgba(0,240,255,0.3);
            padding: 15px 20px; position: relative; 
            clip-path: polygon(15px 0, 100% 0, 100% calc(100% - 15px), calc(100% - 15px) 100%, 0 100%, 0 15px);
            transition: 0.3s;
            display: flex; flex-direction: column; justify-content: space-between;
        }
        .hud-card:hover { border-color: var(--hud-border); box-shadow: 0 0 20px rgba(0,240,255,0.15); }
        .hud-card.flash { animation: flashHUD 0.3s ease-out; }
        @keyframes flashHUD { 0% { background-color: var(--hud-border); } 100% { background-color: var(--hud-panel); } }

        .hud-card-header {
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; margin-bottom: 5px;
        }
        .hud-team-name { font-size: 1.3rem; font-weight: 800; color: #fff; background: transparent; border: none; width: 60%; }
        .hud-coin { font-size: 1.3rem; color: #ffd700; font-family: monospace; font-weight: bold; }

        /* ê·¸ë˜í”„ ë°” */
        .hud-bar-group { display: flex; flex-direction: column; gap: 4px; margin-bottom: 5px; }
        .hud-bar-label-row { display: flex; justify-content: space-between; align-items: center; font-size: 0.8rem; color: #aaa; font-weight: bold; }
        .hud-mini-ctrls { display: flex; gap: 5px; }
        .hud-mini-btn { 
            background: #222; color: #fff; border: 1px solid #444; width: 20px; height: 20px; 
            display: flex; justify-content: center; align-items: center; cursor: pointer; font-size: 0.8rem; 
        }
        .hud-mini-btn:hover { background: #444; border-color: #777; }
        
        .hud-bar-track { width: 100%; height: 10px; background: #000; border: 1px solid #444; position: relative; }
        .hud-bar-fill { height: 100%; transition: width 0.5s cubic-bezier(0.22, 1, 0.36, 1); }
        
        .bar-villain { background: var(--alert-color); box-shadow: 0 0 10px var(--alert-color); }
        .bar-restore { 
            /* [ìˆ˜ì •] ë³µì› ê²Œì´ì§€ëŠ” í•­ìƒ í•˜ëŠ˜ìƒ‰ìœ¼ë¡œ í†µí•© */
            background: #00f0ff; 
            box-shadow: 0 0 10px #00f0ff; 
        }

        /* ë²„íŠ¼ ì»¨íŠ¸ë¡¤ (ì¹´ë“œ ë‚´ë¶€ í†µí•©) */
        .hud-ctrl-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 5px; margin-top: 5px; }
        .hud-ctrl-btn {
            background: rgba(255,255,255,0.05); border: 1px solid #444; color: #aaa;
            padding: 6px 0; cursor: pointer; font-size: 0.8rem; font-weight: bold; transition: 0.2s;
        }
        .hud-ctrl-btn:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.1); }
        .btn-plus { color: #ffd700; border-color: rgba(255, 215, 0, 0.3); }
        .btn-minus { color: #888; }
        .btn-shop-row { grid-column: span 4; margin-top: 5px; background: rgba(0, 240, 255, 0.1); border-color: var(--hud-border); color: var(--hud-border); padding: 8px 0; }
        .btn-shop-row:hover { background: var(--hud-dim); color: #fff; }

        /* í™œë™íŒ (ë¹ˆ í™”ë©´) */
        .empty-state {
            width: 100%; height: 100%; display: flex; justify-content: center; align-items: center;
            font-size: 1.5rem; color: #555; font-weight: bold; letter-spacing: 2px;
            border: 2px dashed #333; border-radius: 20px;
        }

        /* í•˜ë‹¨ ë‰´ìŠ¤ í‹°ì»¤ */
        .hud-footer {
            height: 40px; background: #000; border-top: 2px solid var(--alert-color);
            display: flex; align-items: center; overflow: hidden; white-space: nowrap;
            position: relative; flex: 0 0 40px;
        }
        .ticker-label { 
            background: var(--alert-color); color: #000; font-weight: 900; 
            padding: 0 20px; height: 100%; display: flex; align-items: center; z-index: 2;
        }
        .ticker-text {
            display: inline-block; padding-left: 100%; animation: ticker 40s linear infinite;
            font-family: 'Orbitron', 'Noto Sans KR'; font-weight: bold; color: var(--alert-color); letter-spacing: 1px;
        }
        @keyframes ticker { 0% { transform: translate3d(0, 0, 0); } 100% { transform: translate3d(-100%, 0, 0); } }

        /* ìƒì  ëª¨ë‹¬ (z-index ìˆ˜ì •) */
        .c-modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.85); backdrop-filter: blur(5px);
            z-index: 3000; /* ëª¨ë‹¬ ìµœìƒìœ„ ë³´ì¥ */
            display: none; justify-content: center; align-items: center;
        }
        .c-modal-overlay.active { display: flex; }
        
        .c-modal-box {
            background: #05101a; border: 2px solid var(--hud-border);
            width: 90%; max-width: 500px; border-radius: 10px;
            padding: 25px; text-align: center;
            box-shadow: 0 0 30px rgba(0, 240, 255, 0.3);
        }
        
        .c-item-list { display: grid; gap: 10px; margin: 20px 0; }
        .c-item-btn {
            background: rgba(0,0,0,0.8); border: 1px solid #444; padding: 15px; 
            display: flex; justify-content: space-between; align-items: center; cursor: pointer;
            transition: 0.2s;
        }
        .c-item-btn:hover { border-color: var(--hud-border); background: rgba(0, 240, 255, 0.1); }
        .c-item-price { color: #ffd700; font-weight: bold; }
        .c-action-btn {
            background: #333; border: 1px solid #555; color: #fff;
            padding: 10px 20px; font-weight: bold; cursor: pointer;
        }
        .c-action-btn:hover { background: #555; }

        /* =========================================
           [ê°•ì‚¬ ì½˜ì†” í…Œë§ˆ (í–‰ì„±ë³„ ì»¬ëŸ¬ ë³€ê²½)]
           ========================================= */
        
        /* 1. ìŠ¤ë§ˆíŠ¸ í”Œë˜ë‹› (ê¸°ë³¸: ë ˆë“œ & ì‹œì•ˆ) */
        .theme-smart {
            --hud-border: var(--theme-smart);
            --alert-color: #ff3366; /* ë¹ŒëŸ° ì»¬ëŸ¬ëŠ” ìœ ì§€ */
            --hud-grid: rgba(74, 144, 226, 0.07);
        }

        /* 2. íƒ€ì„ í”Œë˜ë‹› (ê³¨ë“œ/ì˜ë¡œìš° ê³„ì—´) */
        .theme-time {
            --hud-border: var(--theme-time);
            --alert-color: #ffed4a;
            --hud-grid: rgba(241, 196, 15, 0.07);
        }

        /* 3. ê·¸ë¦¿ í”Œë˜ë‹› (ë ˆë“œ/ì˜¤ë Œì§€ ê³„ì—´) */
        .theme-grit {
            --hud-border: var(--theme-grit);
            --alert-color: #ff5733;
            --hud-grid: rgba(231, 76, 60, 0.07);
        }

        /* 4. ëª¨í‹°ë°” í”Œë˜ë‹› (ê·¸ë¦° ê³„ì—´) */
        .theme-motiva {
            --hud-border: var(--theme-motiva);
            --alert-color: #2ecc71;
            --hud-grid: rgba(46, 204, 113, 0.05);
        }

    </style>
</head>
<body>
    <audio id="typeSound" src="type.mp3" preload="auto"></audio>

    <div id="app-container">
        <div class="top-interface" id="top-nav">
            <div class="top-left-group">
                <button class="menu-btn" onclick="toggleMenu()">â‰¡</button>
                <div class="scene-title-display" id="scene-title-text">ì¸íŠ¸ë¡œ</div>
            </div>
            
            <div class="nav-group">
                <button class="nav-btn btn-prev" onclick="handleBack()">ë’¤ë¡œê°€ê¸°</button>
                <button class="nav-btn btn-next" onclick="handleNext()">ë‹¤ìŒìœ¼ë¡œ</button>
            </div>
        </div>

        <div id="side-menu-overlay">
            <div class="menu-header">
                <div class="menu-title">MENU</div>
                <button class="close-menu-btn" onclick="toggleMenu()">Ã—</button>
            </div>
            <ul class="menu-list">
                <li class="menu-item"><a class="menu-link" onclick="menuJump(0)">ğŸ  í™ˆ (ì¸íŠ¸ë¡œ)</a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(1)">ğŸ›« 1. íƒ‘ìŠ¹ ìˆ˜ì†</a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(2)">ğŸ›¸ 2. ë„í‚¹ ì‹œí€€ìŠ¤</a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(3)">ğŸš¨ 3. ë¹„ìƒ ê²½ë³´</a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(4)">ğŸ“œ 4. ì†”ë£¨ì…˜ ìˆ˜ì‹ </a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(5)">ğŸŒŒ 5. í–‰ì„± ì§€ë„</a></li>
                <li class="menu-item"><a class="menu-link" onclick="menuJump(6)">ğŸ’» 6. ê°•ì‚¬ ì½˜ì†”</a></li>
            </ul>
            <div class="settings-area">
                <div class="setting-row">
                    <label class="setting-label">ë°°ê²½ìŒì•… (BGM)</label>
                    <input type="range" class="volume-slider" min="0" max="100" value="50" onchange="console.log('BGM vol:', this.value)">
                </div>
                <div class="setting-row">
                    <label class="setting-label">íš¨ê³¼ìŒ (SFX)</label>
                    <input type="range" class="volume-slider" min="0" max="100" value="30" onchange="setSfxVolume(this.value)">
                </div>
            </div>
        </div>

        <div id="scene-0-intro" class="scene active">
            <div id="intro-thumbnail-layer">
                <div class="thumb-overlay"></div>
                <div style="text-align:center; z-index:10; margin-bottom:50px;">
                    <div style="font-size:2rem; color:#ddd; margin-bottom:10px; font-weight:700;">ë‚´ë©´ì˜ í•™ìŠµì„¸ê³„ë¥¼ êµ¬ì¶œí•˜ë¼</div>
                    <div class="intro-main-title">STUDYVERSE</div>
                </div>
                <button class="start-mission-btn" onclick="startVideoSequence()">MISSION START</button>
            </div>
            <div id="intro-video-layer">
                <video id="intro-video" playsinline><source src="intro.mp4" type="video/mp4"></video>
            </div>
        </div>

        <div id="scene-1-checkin" class="scene">
            <div id="bg-1" class="bg-layer"></div>
            <div class="dialogue-container hidden" id="dialogue-1">
                <button class="skip-btn" onclick="handleSkip()">>> SKIP</button>
                <div class="speaker-name" id="name-1"></div>
                <div class="dialogue-text" id="text-1"></div>
                <div class="next-indicator">â–¼</div>
            </div>
        </div>

        <div id="scene-2-docking" class="scene">
            <div id="bg-2" class="bg-layer"></div>
            <div class="dialogue-container hidden" id="dialogue-2">
                <button class="skip-btn" onclick="handleSkip()">>> SKIP</button>
                <div class="speaker-name" id="name-2"></div>
                <div class="dialogue-text" id="text-2"></div>
                <div class="next-indicator">â–¼</div>
            </div>
        </div>

        <div id="scene-3-crisis" class="scene">
            <div id="bg-4" class="bg-layer"></div> <div class="dialogue-container hidden" id="dialogue-3" style="border-top-color: #ff3366;">
                <button class="skip-btn" onclick="handleSkip()">>> SKIP</button>
                <div class="speaker-name" id="name-3" style="color: #ff3366;"></div>
                <div class="dialogue-text" id="text-3"></div>
                <div class="next-indicator" style="color: #ff3366;">â–¼</div>
            </div>
        </div>

        <div id="scene-4-qr" class="scene">
            <div id="bg-3-static" class="bg-layer-static"></div> <div class="tablet-overlay"><div class="cmd-text">> SYSTEM CONNECTED...<br>> ANALYZING VILLAIN...<br>> DOWNLOADING SOLUTION...</div></div>
            <div class="dialogue-container hidden" id="dialogue-4">
                <button class="skip-btn" onclick="handleSkip()">>> SKIP</button>
                <div class="speaker-name" id="name-4"></div>
                <div class="dialogue-text" id="text-4"></div>
                <div class="next-indicator">â–¼</div>
            </div>
        </div>
        
        <div id="scene-5-map" class="scene">
            <div id="bg-5-space" class="bg-layer-static"></div>
            <div id="space-effects"></div>
            
            <div class="planet-selection-grid">
                <div class="planet-card smart" onclick="showPlanetModal('smart')">
                    <div class="card-bg-villain bg-smart"></div>
                    <img src="planet_smart.png" class="card-mark mark-smart" alt="ìŠ¤ë§ˆíŠ¸ í”Œë˜ë‹› ë§ˆí¬">
                    <div class="card-content">
                        <div>
                            <h3 class="card-title title-smart">SMART PLANET</h3>
                            <p class="card-desc">AIë¥¼ í™œìš©í•´ í•™ìŠµ íš¨ìœ¨ì„ ê·¹ëŒ€í™”í•˜ë¼!</p>
                        </div>
                        <div class="enter-btn-wrap"><button class="enter-btn">ENTER</button></div>
                    </div>
                </div>

                <div class="planet-card time" onclick="showPlanetModal('time')">
                    <div class="card-bg-villain bg-time"></div>
                    <img src="planet_time.png" class="card-mark mark-time" alt="íƒ€ì„ í”Œë˜ë‹› ë§ˆí¬">
                    <div class="card-content">
                        <div>
                            <h3 class="card-title title-time">TIME PLANET</h3>
                            <p class="card-desc">ë¯¸ë£¨ê¸° ìŠµê´€ì„ ëŠê³  ì‹œê°„ì„ í™•ë³´í•˜ë¼!</p>
                        </div>
                        <div class="enter-btn-wrap"><button class="enter-btn">ENTER</button></div>
                    </div>
                </div>

                <div class="planet-card grit" onclick="showPlanetModal('grit')">
                    <div class="card-bg-villain bg-grit"></div>
                    <img src="planet_grit.png" class="card-mark mark-grit" alt="ê·¸ë¦¿ í”Œë˜ë‹› ë§ˆí¬">
                    <div class="card-content">
                        <div>
                            <h3 class="card-title title-grit">GRIT PLANET</h3>
                            <p class="card-desc">í¬ê¸°í•˜ì§€ ì•ŠëŠ” ëˆê¸°ë¥¼ ì¦ëª…í•˜ë¼!</p>
                        </div>
                        <div class="enter-btn-wrap"><button class="enter-btn">ENTER</button></div>
                    </div>
                </div>

                <div class="planet-card motiva" onclick="showPlanetModal('motiva')">
                    <div class="card-bg-villain bg-motiva"></div>
                    <img src="planet_motiva.png" class="card-mark mark-motiva" alt="ëª¨í‹°ë°” í”Œë˜ë‹› ë§ˆí¬">
                    <div class="card-content">
                        <div>
                            <h3 class="card-title title-motiva">MOTIVA PLANET</h3>
                            <p class="card-desc">ìƒì–´ë²„ë¦° í•™ìŠµ ë™ê¸°ë¥¼ ë˜ì°¾ì•„ë¼!</p>
                        </div>
                        <div class="enter-btn-wrap"><button class="enter-btn">ENTER</button></div>
                    </div>
                </div>
            </div>
        </div>

        <div id="scene-6-console" class="scene">
            <div class="hud-header">
                <div class="hud-header-left">
                    <button class="menu-btn" onclick="toggleMenu()">â‰¡</button>
                    <div class="hud-title">STUDYVERSE OP.CONSOLE</div>
                </div>
                
                <div class="hud-header-center">
                    <button id="tab-status" class="hud-tab-btn active" onclick="app.setMode('status')">í˜„í™©íŒ (STATUS)</button>
                    <button id="tab-activity" class="hud-tab-btn" onclick="app.setMode('activity')">í™œë™íŒ (ACTIVITY)</button>
                </div>

                <div class="hud-header-right">
                    <button class="hud-btn" onclick="changeScene(5)">â—€ í–‰ì„±ìœ¼ë¡œ</button>
                </div>
            </div>

            <div class="hud-body">
                <div class="hud-left-panel">
                    <div class="model-box">
                        <img src="villain_smart.png" class="villain-img" alt="TARGET VILLAIN">
                        <div class="model-label">ë¹ŒëŸ°: ìš¸íŠ¸ë¡ </div>
                    </div>
                </div>

                <div class="hud-right-panel">
                    <div id="hud-team-container" class="hud-team-grid"></div>
                </div>
            </div>

            <div class="hud-footer">
                <div class="ticker-label">WARNING!</div>
                <div class="ticker-text">âš  ê¸´ê¸‰ ê²½ê³ : ë‚´ë©´ì˜ í•™ìŠµ ì„¸ê³„ê°€ ë¶•ê´´ë˜ê³  ìˆìŠµë‹ˆë‹¤... ë¹ŒëŸ°ì„ ì €ì§€í•˜ê³  í–‰ì„±ì„ ë³µì›í•˜ì—¬ ì‹œìŠ¤í…œì„ ì•ˆì •í™”í•˜ì‹­ì‹œì˜¤... ëª¨ë“  íŒ€ì€ ì¦‰ì‹œ ì‘ì „ì„ ìˆ˜í–‰í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤... (ë°˜ë³µ) &nbsp;&nbsp;&nbsp;&nbsp;&nbsp; âš  ê¸´ê¸‰ ê²½ê³ : ë‚´ë©´ì˜ í•™ìŠµ ì„¸ê³„ê°€ ë¶•ê´´ë˜ê³  ìˆìŠµë‹ˆë‹¤... ë¹ŒëŸ°ì„ ì €ì§€í•˜ê³  í–‰ì„±ì„ ë³µì›í•˜ì—¬ ì‹œìŠ¤í…œì„ ì•ˆì •í™”í•˜ì‹­ì‹œì˜¤...</div>
            </div>
        </div>
    </div>

    <div id="planet-modal">
        <div class="pm-content" id="pm-box">
            <div class="pm-title" id="pm-title"></div>
            <div class="pm-desc" id="pm-desc"></div>
            <div class="pm-buttons">
                <button class="pm-btn pm-btn-cancel" onclick="closePlanetModal()">ì·¨ì†Œ</button>
                <button class="pm-btn pm-btn-confirm" id="pm-confirm" onclick="confirmPlanetEnter()">ì§„ì…í•˜ê¸°</button>
            </div>
        </div>
    </div>

    <div id="shop-modal" class="c-modal-overlay">
        <div class="c-modal-box">
            <h2 style="margin-top:0; color:var(--hud-border); font-family:'Orbitron'">ITEM SHOP</h2>
            <p id="shop-target-team" style="color:#aaa">Target: 1íŒ€</p>
            <div class="c-item-list" id="item-list-container"></div>
            <button class="c-action-btn" onclick="document.getElementById('shop-modal').classList.remove('active')">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        // ============================================
        // [1. ìŠ¤í† ë¦¬ ëª¨ë“œ ë¡œì§ (Scene 0 ~ 5)]
        // ============================================
        const planetData = {
            smart: { name: "ìŠ¤ë§ˆíŠ¸ í”Œë˜ë‹›", desc: "AIë¥¼ í™œìš©í•´ í•™ìŠµ íš¨ìœ¨ì„ ê·¹ëŒ€í™”í•˜ë¼!", color: "#4a90e2" },
            time: { name: "íƒ€ì„ í”Œë˜ë‹›", desc: "ë¯¸ë£¨ê¸° ìŠµê´€ì„ ëŠê³  ì‹œê°„ì„ í™•ë³´í•˜ë¼!", color: "#f1c40f" },
            grit: { name: "ê·¸ë¦¿ í”Œë˜ë‹›", desc: "í¬ê¸°í•˜ì§€ ì•ŠëŠ” ëˆê¸°ë¥¼ ì¦ëª…í•˜ë¼!", color: "#e74c3c" },
            motiva: { name: "ëª¨í‹°ë°” í”Œë˜ë‹›", desc: "ìƒì–´ë²„ë¦° í•™ìŠµ ë™ê¸°ë¥¼ ë˜ì°¾ì•„ë¼!", color: "#2ecc71" }
        };
        const sceneInfo = {
            0: { title: "ì¸íŠ¸ë¡œ" },
            1: { title: "1. íƒ‘ìŠ¹ ìˆ˜ì†" },
            2: { title: "2. ë„í‚¹ ì‹œí€€ìŠ¤" },
            3: { title: "3. ë¹„ìƒ ê²½ë³´" },
            4: { title: "4. ì†”ë£¨ì…˜ ìˆ˜ì‹ " },
            5: { title: "5. í–‰ì„± ì§€ë„" },
            6: { title: "6. ê°•ì‚¬ ì½˜ì†”" }
        };

        const rawDialogues = {
            1: `ë‚˜: ì—¬ê¸°â€¦ ìŠ¤í„°ë””ë²„ìŠ¤ ê²Œì´íŠ¸ A1 ë§ë‚˜?\nì•ˆë‚´ì›: ë„¤, ë§ìŠµë‹ˆë‹¤. ì—¬ê¶Œê³¼ íƒ‘ìŠ¹ê¶Œì„ ë³´ì—¬ì£¼ì„¸ìš”.\në‚˜: ì–´â€¦ ë„¤. ì—¬ê¸°ìš”.\nì‹œìŠ¤í…œ: ë¬¸ì„œ ì¸ì‹ ì¤‘â€¦ ì—¬ê¶Œ ì¸ì¦ ì™„ë£Œ. í•­ê³µê¶Œ ì¸ì¦ ì™„ë£Œ.\nì•ˆë‚´ì›: í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. ì§€ê¸ˆë¶€í„° ê²Œì´íŠ¸ë¥¼ ì§€ë‚œ í›„ ìš°ì¸¡ì— ìˆëŠ” ìš°ì£¼ì„ ì— íƒ‘ìŠ¹í•˜ì‹œë©´ ë©ë‹ˆë‹¤.\në‚˜: ìš°ì¸¡â€¦ ìš°ì£¼ì„ ? ì§„ì§œ ìš°ì£¼ì„  íƒ€ëŠ” ê±°ë„¤.\nì‹œìŠ¤í…œ: ê²Œì´íŠ¸ ê°œë°©. íƒ‘ìŠ¹ê° í†µê³¼ë¥¼ í—ˆê°€í•©ë‹ˆë‹¤. íƒ‘ìŠ¹ ì²˜ë¦¬ ì¤‘â€¦ ì¢Œì„ ë°°ì • ì™„ë£Œ.\në‚˜: ë‚´ íƒ‘ìŠ¹ê¶Œì´ ì§„ì§œ ì˜€ë‹¤ë‹ˆ ì–´ë–»ê²Œ ìƒí™©ì´ í˜ëŸ¬ê°€ëŠ”ê±´ì§€.. ì˜¤ì¼€ì´ ì¼ë‹¨ ê°€ë³´ì.`,
            2: `ì ì‹œí›„..\nì‹œìŠ¤í…œ: ì™¸ë¶€ ì‹œì•¼ ì „í™˜, ë„í‚¹ ì ˆì°¨ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.\në‚˜: ì™€â€¦ ì €ê²Œ ì •ê±°ì¥ì´ì•¼? ìƒê°ë³´ë‹¤ í›¨ì”¬ í°ë°?\nì‹œìŠ¤í…œ: ì ‘ê·¼ ì†ë„ ì¡°ì • ì¤‘â€¦ ë„í‚¹ í¬íŠ¸ ì¢Œí‘œ ê³„ì‚° ì¤‘â€¦ ë„í‚¹ í¬íŠ¸ ì •ë ¬, ë¯¸ì„¸ ë³´ì • ì§„í–‰.\në‚˜: ì§€ê¸ˆâ€¦ ë¶™ìœ¼ëŸ¬ ê°€ëŠ” ê±°ì§€? ê´œíˆ ê¸´ì¥ë˜ë„¤.\nì‹œìŠ¤í…œ: ì ‘ì´‰ê¹Œì§€ 5â€¦ 4â€¦ 3â€¦\në‚˜: ì œë°œâ€¦ ë¶€ë“œëŸ½ê²Œ ë¶™ì–´ë¼.\nì‹œìŠ¤í…œ: 2â€¦ 1â€¦ ì ‘ì´‰!\n(íš¨ê³¼ìŒ): ì¿µâ€¦\nì‹œìŠ¤í…œ: ë„í‚¹ ì™„ë£Œ. ê¸°ì•• ì•ˆì •í™” ì¤‘â€¦ ì—°ê²° í†µë¡œ ê°œë°© ì¤€ë¹„. ì¶œì… ê°€ëŠ¥ê¹Œì§€ 3â€¦ 2â€¦ 1â€¦ ì¶œì… ì¤€ë¹„ ì™„ë£Œ.\në‚˜: ì˜¤ì¼€ì´. ë“œë””ì–´ ë„ì°©í–ˆë‹¤.. ë„ˆë¬´ ê¸´ì¥í–ˆë”ë‹ˆ ì˜¨ ëª¸ì´ ë»ê·¼í•˜ë„¤ ì´ì œ ì•ˆìœ¼ë¡œ ë“¤ì–´ê°€ë©´ ë˜ëŠ” ê±°ì§€?`,
            3: `ì¹˜ì§€ì§â€¦ ì¹˜ì§. (ê°‘ìê¸° ìš¸ë¦¬ëŠ” ìŒì„± ìˆ˜ì‹ ê¸°)\n??: ë“œë””ì–´ ì™”êµ¬ë‚˜!\në‚˜: ëˆ„êµ¬ì•¼? ë‚˜í•œí…Œ ìŒì„± ì†¡ì‹ ì„ í•  ì‚¬ëŒì´ ì—†ëŠ”ë°?\nì•„ë¦¬: ì„¤ëª…í•  ì‹œê°„ ì—†ì–´! ë„ˆ ì§€ê¸ˆ ìŠ¤í„°ë””ë²„ìŠ¤ ë„í‚¹ êµ¬ì—­ ë§ì§€?\nì‹œìŠ¤í…œ: ê²½ê³ . ì„ ì²´ ì••ë ¥ ë¶ˆì•ˆì •. ë¹„ìƒ ëª¨ë“œ ì „í™˜.\në‚˜: ë­ì•¼â€¦ ì™œ ê°‘ìê¸° ê²½ê³ ê°€ ë– . ë°©ê¸ˆê¹Œì§€ ë©€ì©¡í–ˆëŠ”ë°.\ní† ë¦¬: ì§€ê¸ˆ ìŠ¤í„°ë””ë²„ìŠ¤ê°€ ë¬´ë„ˆì§€ê³  ìˆì–´.\në‚˜: ë¬´ë„ˆì§„ë‹¤ê³ ? ìŠ¤í„°ë””ë²„ìŠ¤ê°€ ì™œ ë¬´ë„ˆì ¸ ì´ê±´ ì—„ì—°íˆ ë‚˜ë§Œì˜ ì„¸ê³„ì¸ë°\nì•„ë¦¬: ëˆ„êµ°ê°€ ì¼ë¶€ëŸ¬ ë§ê°€ëœ¨ë¦¬ëŠ” ì¤‘ì´ê³  ìš°ë¦¬ëŠ” ì§€ê¸ˆ ìŠ¤í„°ë””ë²„ìŠ¤ë¥¼ ì§€í‚¤ê³  ìˆì—ˆì–´.\ní† ë¦¬: ë¹ŒëŸ°ë“¤ì´ ë„ˆê°€ ì™”ë‹¤ëŠ” ì†Œì‹ì„ ë“£ê³  ë„í‚¹ìŠ¤í…Œì´ì…˜ì— ì ‘ê·¼í•œ ê²ƒ ê°™ì•„\në‚˜: ë¹ŒëŸ°â€¦? ì¥ë‚œì´ ì•„ë‹ˆë„¤.\nì•„ë¦¬: ì²« ë²ˆì§¸ëŠ” ìš¸íŠ¸ë¡ . AIë¥¼ ëª» ì“°ê²Œ ë§‰ê³  íš¨ìœ¨ì„ ì™œê³¡í•´.\ní† ë¦¬: ì›ë˜ëŠ” ì•ˆì „ ê²½ë¡œê°€ ë– ì•¼ ë¼. ê·¼ë° ì „ë¶€ êº¼ì¡Œì„ê±°ì•¼, ê·¸ê²Œ ìš¸íŠ¸ë¡  ì§“ì´ì•¼. ë„ˆë¥¼ í˜¼ë€ìŠ¤ëŸ½ê²Œ ë§Œë“¤ì–´ì„œ í¬ê¸°í•˜ê²Œ í•˜ì§€.\nì•„ë¦¬: ë‘ ë²ˆì§¸ëŠ” ë”œë ˆì´ì–´. ë¯¸ë£¨ê²Œ ë§Œë“¤ê³  ì‹œê°„ì„ ì§ˆì§ˆ ëŒê²Œ í•´.\nì‹œìŠ¤í…œ: ì‘ì—… ì§€ì—° ìœ ë„ ì‹ í˜¸ ê°ì§€. íƒ€ì´ë¨¸ ì˜¤ë¥˜ ë°œìƒ.\në‚˜: ì´ìƒí•´. ì§€ê¸ˆ ë‹¹ì¥ ì›€ì§ì—¬ì•¼ í•  ê²ƒ ê°™ì€ë° ëª¸ì´ êµ¼ë– .\nì•„ë¦¬: ê·¸ ê°ê°ì´ ë”œë ˆì´ì–´ì•¼. ì§€ê¸ˆ ì´ ìˆœê°„ì— â€œë‚˜ì¤‘ì—â€ë¥¼ ì‹¬ëŠ” ê±°ì§€.\ní† ë¦¬: ê³§ QR ì›Œí¬ì§€ê°€ ë„ì°©í•  ê±°ì•¼. ê·¸ê±¸ í™•ì¸í•˜ê³  ê·¸ëŒ€ë¡œ ë”°ë¼ í•˜ë©´ ë¼.`,
            4: `ì‹œìŠ¤í…œ: ìˆ˜ì‹  ì™„ë£Œ. ì‹œìŠ¤í…œ: íƒœë¸”ë¦¿ ì—°ê²° ì¤‘â€¦ ì¹˜ì§â€¦ ì¹˜ì§€ì§â€¦\në‚˜: ë‚˜ ì§€ê¸ˆ ë„ì°©í–ˆê³  ì´ì œë¶€í„° ë‚´ê°€ ë­˜ í•˜ë©´ ë˜ëŠ”ê±°ì•¼?\nì•„ë¦¬: ê¸ˆë°© ì™”ë„¤! ì§€ê¸ˆì€ íƒœë¸”ë¦¿ë¶€í„° ì œëŒ€ë¡œ ì¡ì•„. ì§€ê¸ˆë¶€í„° ê·¸ í™”ë©´ì´ ì•ˆë‚´ì„œì•¼. ë‚´ê°€ QRì½”ë“œë¥¼ ë³´ëƒˆëŠ”ë° í™•ì¸ëì–´?\nì‹œìŠ¤í…œ: QR ì›Œí¬ì§€ í‘œì‹œ ì¤€ë¹„. QR ì›Œí¬ì§€ ë¡œë”©â€¦ ì‹ í˜¸ ì•ˆì •í™”.\në‚˜: ê·¼ë° í™”ë©´ì´ ì•„ì§ ë¹„ì–´ ìˆëŠ”ë°.\ní† ë¦¬: ê°–ê³  ìˆëŠ” ìŠ¤ë§ˆíŠ¸í°ì„ í™œìš©í•´ì„œ QRì½”ë“œë¥¼ ë¹¨ë¦¬ ì°ê³  ì›Œí¬ì§€ë¥¼ í™•ë³´í•´!\nì•„ë¦¬: ì§€ê¸ˆë¶€í„°ëŠ” ê·¸ ì›Œí¬ì§€ëŒ€ë¡œ ì›€ì§ì´ë©´ ë¼.\ní† ë¦¬: í•œ ë²ˆì— ë‹¤ ë³´ë ¤ê³  í•˜ì§€ ë§ˆ. ìœ„ì—ì„œë¶€í„° í•˜ë‚˜ì”©. ì•ì—ì„œ ë„ˆë¥¼ ì¸ë„í•´ì£¼ëŠ” ì¸ë„ì(ê°•ì‚¬)ê°€ ìˆì„ê±°ì•¼. ê·¸ ì‚¬ëŒì˜ ì•ˆë‚´ë¥¼ ì˜ ë”°ë¥´ë©´ ë¼! ê·¸ëŸ¬ë©´ ë¶„ëª… ë¹ŒëŸ°ì„ ë¬´ì°Œë¥¼ ìˆ˜ ìˆì„ê±°ì•¼!\në‚˜: ì•Œê² ì–´. ì¼ë‹¨ ì•ˆë‚´ë¥¼ ë°›ê³  ìµœëŒ€í•œ ë¹ŒëŸ°ì„ ì €ì§€í•˜ë ¤ê³  ë…¸ë ¥í•´ë³¼ê²Œ!`
        };

        let dialogueQueue = {};
        function parseDialogues() {
            for (const [scene, text] of Object.entries(rawDialogues)) {
                dialogueQueue[scene] = text.split('\n').filter(line => line.trim() !== "").map(line => {
                    const parts = line.split(/:\s(.+)/);
                    return parts.length >= 2 ? { speaker: parts[0].trim(), text: parts[1].trim() } : { speaker: " ", text: line.trim() };
                });
            }
        }
        parseDialogues();

        let currentScene = 0;
        let introStep = 0;
        let selectedPlanetKey = '';
        let typingInterval;
        let currentLineIndex = 0; 
        let isTyping = false; 
        const typeSound = document.getElementById('typeSound'); 
        if(typeSound) typeSound.volume = 0.3;

        updateInterface(0);

        function handleNext() {
            if (currentScene === 0) {
                if (introStep === 0) startVideoSequence();
                else { document.getElementById('intro-video').pause(); changeScene(1); }
                return;
            }
            if (currentScene >= 1 && currentScene <= 4) {
                const box = document.getElementById(`dialogue-${currentScene}`);
                const queue = dialogueQueue[currentScene];
                if (box.classList.contains('hidden')) {
                    box.classList.remove('hidden');
                    currentLineIndex = 0;
                    playNextLine(currentScene);
                    return;
                }
                if (isTyping) { completeTyping(currentScene); return; }
                if (currentLineIndex < queue.length) {
                    playNextLine(currentScene);
                } else {
                    if (currentScene < 6) changeScene(currentScene + 1);
                }
                return;
            }
            if (currentScene < 6) changeScene(currentScene + 1);
        }

        function handleBack() {
            if (currentScene === 0) { resetIntro(); return; }
            if (currentScene >= 1 && currentScene <= 4) {
                if (isTyping) { completeTyping(currentScene); return; }
                if (currentLineIndex > 1) {
                    currentLineIndex -= 2; 
                    playNextLine(currentScene, true); 
                    return;
                }
            }
            if (currentScene > 0) { changeScene(currentScene - 1); }
        }

        function handleSkip() {
            if (currentScene < 6) changeScene(currentScene + 1);
        }

        function startVideoSequence() {
            document.getElementById('intro-thumbnail-layer').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('intro-thumbnail-layer').style.display = 'none';
                const vidLayer = document.getElementById('intro-video-layer');
                vidLayer.style.display = 'block';
                document.getElementById('intro-video').currentTime = 0;
                document.getElementById('intro-video').play();
                document.getElementById('top-nav').classList.add('visible');
            }, 500);
            introStep = 1;
        }
        function resetIntro() {
            introStep = 0;
            const thumb = document.getElementById('intro-thumbnail-layer');
            thumb.style.display='flex'; setTimeout(()=>thumb.style.opacity='1',50);
            document.getElementById('intro-video-layer').style.display='none';
            document.getElementById('intro-video').pause();
            document.getElementById('top-nav').classList.remove('visible');
        }

        function changeScene(num) {
            document.querySelectorAll('.scene').forEach(el => el.classList.remove('active'));
            if(num === 0) resetIntro();

            const sceneId = num === 6 ? 'scene-6-console' : `scene-${num}-${getSceneName(num)}`;
            const nextScene = document.getElementById(sceneId);
            
            if (nextScene) {
                nextScene.classList.add('active');
                currentScene = num;
                updateInterface(num);
                
                if (num === 5) createSpaceEffects();
                else document.getElementById('space-effects').innerHTML = '';

                if (num === 6) {
                    app.init();
                }

                if (num >= 1 && num <= 4) {
                    currentLineIndex = 0;
                    document.getElementById(`dialogue-${num}`).classList.add('hidden');
                }
            }
        }

        function getSceneName(num) {
            const map = { 0: 'intro', 1: 'checkin', 2: 'docking', 3: 'crisis', 4: 'qr', 5: 'map', 6: 'console' };
            return map[num];
        }

        function updateInterface(num) {
            const info = sceneInfo[num] || { title: "" };
            const title = document.getElementById('scene-title-text');
            if(title) title.innerText = info.title;
            
            const nav = document.getElementById('top-nav');
            // Scene 6ì—ì„œëŠ” ìƒë‹¨ë°”ë¥¼ ìˆ¨ê¹€ (ìì²´ í—¤ë” ì‚¬ìš©)
            if (num > 0 && num < 6) nav.classList.add('visible');
            else if (num === 0 && introStep === 1) nav.classList.add('visible');
            else nav.classList.remove('visible');
            
            if (num === 3) document.documentElement.style.setProperty('--current-theme', '#ff3366'); 
            else document.documentElement.style.setProperty('--current-theme', '#00f0ff');
        }

        function playNextLine(sceneNum, instant = false) {
            const queue = dialogueQueue[sceneNum];
            if (!queue || currentLineIndex >= queue.length) return;
            const lineData = queue[currentLineIndex];
            const nameEl = document.getElementById(`name-${sceneNum}`);
            const textEl = document.getElementById(`text-${sceneNum}`);
            const ind = nameEl.parentElement.querySelector('.next-indicator');
            if(ind) ind.style.display = 'none';

            nameEl.innerText = lineData.speaker;
            updateSpeakerColor(nameEl, lineData.speaker);

            if (instant) {
                textEl.innerText = lineData.text;
                isTyping = false;
                currentLineIndex++;
                if(ind) ind.style.display = 'block';
                return;
            }
            isTyping = true;
            textEl.innerHTML = ''; 
            let i = 0;
            const text = lineData.text;
            clearInterval(typingInterval);
            typingInterval = setInterval(() => {
                if (i >= text.length) { completeTyping(sceneNum); return; }
                textEl.innerHTML += text[i];
                if (text[i] !== ' ' && typeSound) { typeSound.currentTime = 0; typeSound.play().catch(e=>{}); }
                i++;
            }, 30);
        }

        function completeTyping(sceneNum) {
            clearInterval(typingInterval);
            const queue = dialogueQueue[sceneNum];
            const lineData = queue[currentLineIndex];
            document.getElementById(`text-${sceneNum}`).innerText = lineData.text;
            isTyping = false;
            currentLineIndex++;
            const ind = document.getElementById(`name-${sceneNum}`).parentElement.querySelector('.next-indicator');
            if(ind) ind.style.display = 'block';
        }

        function updateSpeakerColor(el, name) {
            if (name.includes("ë‚˜")) el.style.color = "#ff3366";
            else if (name.includes("ì‹œìŠ¤í…œ")) el.style.color = "#00ff00";
            else if (name.includes("ì•„ë¦¬")) el.style.color = "#00f0ff";
            else if (name.includes("í† ë¦¬")) el.style.color = "#ff00ff";
            else el.style.color = "#ffffff";
        }

        function createSpaceEffects() {
            const container = document.getElementById('space-effects');
            if (!container) return;
            container.innerHTML = ''; 
            const colors = ['#f0f', '#0ff', '#ff0'];
            for (let i = 0; i < 30; i++) {
                const star = document.createElement('div');
                star.classList.add('star');
                star.style.left = Math.random()*100 + '%'; star.style.top = Math.random()*100 + '%';
                const size = Math.random()*3 + 1; star.style.width = size+'px'; star.style.height = size+'px';
                star.style.setProperty('--star-color', colors[Math.floor(Math.random()*3)]);
                star.style.animation = `realistic-pulse-slow ${Math.random()*5+5}s infinite ${Math.random()*5}s`;
                container.appendChild(star);
            }
        }

        function showPlanetModal(key) {
            selectedPlanetKey = key;
            const data = planetData[key];
            const pmBox = document.getElementById('pm-box');
            document.getElementById('pm-title').innerText = data.name;
            document.getElementById('pm-desc').innerText = data.desc;
            document.getElementById('pm-title').style.color = data.color;
            document.getElementById('pm-confirm').style.backgroundColor = data.color;
            pmBox.style.borderColor = data.color;
            pmBox.style.setProperty('--p-color', data.color);
            document.getElementById('planet-modal').style.display = 'flex';
        }
        function closePlanetModal() { document.getElementById('planet-modal').style.display = 'none'; }
        
        function confirmPlanetEnter() {
            // 1. ëª¨ë‹¬ ë‹«ê¸°
            closePlanetModal();

            // 2. ì„ íƒëœ í–‰ì„± í‚¤ ê°€ì ¸ì˜¤ê¸° (smart, time, grit, motiva)
            const planet = selectedPlanetKey;

            // 3. ì½˜ì†”(Scene 6) ìš”ì†Œ ê°€ì ¸ì˜¤ê¸°
            const consoleEl = document.getElementById('scene-6-console');
            const imgEl = consoleEl.querySelector('.villain-img');
            const labelEl = consoleEl.querySelector('.model-label');

            // 4. ê¸°ì¡´ í…Œë§ˆ í´ë˜ìŠ¤ ì œê±° í›„ ìƒˆ í…Œë§ˆ ì ìš©
            consoleEl.classList.remove('theme-smart', 'theme-time', 'theme-grit', 'theme-motiva');
            consoleEl.classList.add(`theme-${planet}`);

            // 5. ë¹ŒëŸ° ì´ë¯¸ì§€ ë³€ê²½ ë° í´ë˜ìŠ¤ êµì²´
            imgEl.src = `villain_${planet}.png`; 
            
            // ê¸°ì¡´ ë¹ŒëŸ° í´ë˜ìŠ¤ ì œê±°í•˜ê³  ìƒˆ ë¹ŒëŸ° í´ë˜ìŠ¤ ì¶”ê°€
            imgEl.classList.remove('villain-smart', 'villain-time', 'villain-grit', 'villain-motiva');
            imgEl.classList.add(`villain-${planet}`);
            
            // íƒ€ê²Ÿ ì´ë¦„ ì„¤ì • (í•œê¸€ë¡œ ë³€ê²½)
            let villainName = "ë¹ŒëŸ°: ìš¸íŠ¸ë¡ ";
            if(planet === 'smart') villainName = "ë¹ŒëŸ°: ìš¸íŠ¸ë¡ ";
            if(planet === 'time') villainName = "ë¹ŒëŸ°: ë”œë ˆì´ì–´";
            if(planet === 'grit') villainName = "ë¹ŒëŸ°: ì‡¼íŠ¸ì»¤í„°";
            if(planet === 'motiva') villainName = "ë¹ŒëŸ°: ë¸”ë­ì»¤";
            labelEl.innerText = villainName;

            // 6. ì”¬ ì „í™˜
            changeScene(6); 
        }

        function toggleMenu() {
            const menu = document.getElementById('side-menu-overlay');
            menu.classList.toggle('active');
        }
        function menuJump(sceneNum) {
            toggleMenu();
            changeScene(sceneNum);
        }
        function setSfxVolume(val) {
            if(typeSound) typeSound.volume = val / 100;
        }


        // ============================================
        // [2. ê°•ì‚¬ ì‘ì „ ì½˜ì†” ë¡œì§ (Scene 6) - ë¦¬ë‰´ì–¼]
        // ============================================
        const CONFIG = {
            defaultTeams: 6,
            maxHP: 3,
            maxRestore: 3,
            items: [
                { id: 'atk', name: 'âš”ï¸ ê¸°ìŠµê³µê²©', price: 12, desc: 'ë¹ŒëŸ° ì²´ë ¥ ê°ì†Œ', type: 'combat' },
                { id: 'heal', name: 'ğŸ’Š ë³µì›ë¶€ìŠ¤í„°', price: 12, desc: 'í–‰ì„± ë³µì› ì§„í–‰', type: 'restore' },
                { id: 'food', name: 'ğŸ ì‹ëŸ‰êµ¬ë§¤', price: 3, desc: 'ëª¨ë‘ ì› ì „ì²´ ê°„ì‹', type: 'food' }
            ]
        };

        const app = {
            state: {
                teams: [],
                mode: 'status' // 'status' or 'activity'
            },
            
            init() {
                const saved = localStorage.getItem('sv_console_state_v2');
                if (saved) {
                    this.state = JSON.parse(saved);
                    // ëª¨ë“œ ì´ˆê¸°í™”
                    this.state.mode = 'status'; 
                } else {
                    this.createInitialData();
                }
                this.render();
            },

            createInitialData() {
                this.state.teams = Array.from({ length: CONFIG.defaultTeams }, (_, i) => ({
                    id: i + 1,
                    name: `${i + 1}ì¡°`,
                    coin: 0,
                    damage: 0, // 0~3 (3ì´ë©´ ì²˜ì¹˜)
                    restore: 0 // 0~3 (3ì´ë©´ ì™„ë£Œ)
                }));
                this.save();
            },

            save() {
                localStorage.setItem('sv_console_state_v2', JSON.stringify(this.state));
            },

            setMode(mode) {
                this.state.mode = mode;
                document.querySelectorAll('.hud-tab-btn').forEach(btn => btn.classList.remove('active'));
                document.getElementById(`tab-${mode}`).classList.add('active');
                this.render();
            },

            action(type, payload) {
                const team = this.state.teams.find(t => t.id === payload.id);
                if (!team) return;

                switch (type) {
                    case 'coin':
                        if (team.coin + payload.amount < 0) return alert("ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.");
                        team.coin += payload.amount;
                        this.flashCard(team.id);
                        break;
                    case 'rename':
                        team.name = payload.name;
                        break;
                    case 'damage': // ìˆ˜ë™ ì¡°ì ˆìš©
                        const d = team.damage + payload.val;
                        if(d >= 0 && d <= CONFIG.maxHP) team.damage = d;
                        break;
                    case 'restore': // ìˆ˜ë™ ì¡°ì ˆìš©
                        const r = team.restore + payload.val;
                        if(r >= 0 && r <= CONFIG.maxRestore) team.restore = r;
                        break;
                }
                this.save();
                this.render();
            },

            openShop(teamId) {
                const team = this.state.teams.find(t => t.id === teamId);
                const modal = document.getElementById('shop-modal');
                const list = document.getElementById('item-list-container');
                const targetText = document.getElementById('shop-target-team');

                targetText.innerText = `êµ¬ë§¤ ëŒ€ìƒ: ${team.name} (ë³´ìœ  G: ${team.coin})`;
                list.innerHTML = '';

                CONFIG.items.forEach(item => {
                    const btn = document.createElement('div');
                    btn.className = 'c-item-btn';
                    const canBuy = team.coin >= item.price;
                    
                    btn.innerHTML = `
                        <div>
                            <div style="font-weight:bold; color:${canBuy ? '#fff' : '#555'}">${item.name}</div>
                            <div style="font-size:0.8rem; color:#888">${item.desc}</div>
                        </div>
                        <div class="c-item-price" style="color:${canBuy ? '#ffd700' : '#555'}">${item.price} G</div>
                    `;
                    
                    if (canBuy) {
                        btn.onclick = () => this.buyItem(team.id, item);
                    } else {
                        btn.style.opacity = '0.5';
                        btn.style.cursor = 'not-allowed';
                    }
                    list.appendChild(btn);
                });

                modal.classList.add('active');
            },

            buyItem(teamId, item) {
                const team = this.state.teams.find(t => t.id === teamId);
                team.coin -= item.price;

                if (item.type === 'combat') {
                    if (team.damage < CONFIG.maxHP) team.damage++;
                } else if (item.type === 'restore') {
                    if (team.restore < CONFIG.maxRestore) team.restore++;
                }
                
                document.getElementById('shop-modal').classList.remove('active');
                this.save();
                this.render();
                this.flashCard(team.id);
            },

            flashCard(id) {
                const el = document.getElementById(`card-${id}`);
                if (el) {
                    el.classList.remove('flash');
                    void el.offsetWidth;
                    el.classList.add('flash');
                }
            },

            render() {
                const container = document.getElementById('hud-team-container');
                container.innerHTML = '';

                // === í™œë™íŒ(Activity) ëª¨ë“œì¼ ë•Œ ë¹ˆ í™”ë©´ ì²˜ë¦¬ ===
                if (this.state.mode === 'activity') {
                    container.innerHTML = `<div class="empty-state">ì¶”í›„ ì½˜í…ì¸  ì—…ë°ì´íŠ¸ ì˜ˆì •</div>`;
                    container.style.display = 'block';
                    return;
                }

                // === í˜„í™©íŒ(Status) ëª¨ë“œì¼ ë•Œ ===
                container.style.display = 'grid'; 

                this.state.teams.forEach(team => {
                    const div = document.createElement('div');
                    div.className = 'hud-card';
                    div.id = `card-${team.id}`;

                    const villainPct = ((CONFIG.maxHP - team.damage) / CONFIG.maxHP) * 100;
                    const restorePct = (team.restore / CONFIG.maxRestore) * 100;

                    div.innerHTML = `
                        <div class="hud-card-header">
                            <input type="text" class="hud-team-name" value="${team.name}" onchange="app.action('rename', {id:${team.id}, name:this.value})">
                            <span class="hud-coin">${team.coin} G</span>
                        </div>
                        
                        <div class="hud-bar-group">
                            <div class="hud-bar-label-row">
                                <span>ë¹ŒëŸ° ì²´ë ¥ (${CONFIG.maxHP - team.damage})</span>
                                <div class="hud-mini-ctrls">
                                    <button class="hud-mini-btn" onclick="app.action('damage', {id:${team.id}, val:-1})">+</button>
                                    <button class="hud-mini-btn" onclick="app.action('damage', {id:${team.id}, val:1})">-</button>
                                </div>
                            </div>
                            <div class="hud-bar-track"><div class="hud-bar-fill bar-villain" style="width:${villainPct}%"></div></div>
                        </div>

                        <div class="hud-bar-group">
                            <div class="hud-bar-label-row">
                                <span>í–‰ì„± ë³µì› (${team.restore})</span>
                                <div class="hud-mini-ctrls">
                                    <button class="hud-mini-btn" onclick="app.action('restore', {id:${team.id}, val:-1})">-</button>
                                    <button class="hud-mini-btn" onclick="app.action('restore', {id:${team.id}, val:1})">+</button>
                                </div>
                            </div>
                            <div class="hud-bar-track"><div class="hud-bar-fill bar-restore" style="width:${restorePct}%"></div></div>
                        </div>

                        <div class="hud-ctrl-row">
                            <button class="hud-ctrl-btn btn-plus" onclick="app.action('coin', {id:${team.id}, amount:1})">+1</button>
                            <button class="hud-ctrl-btn btn-plus" onclick="app.action('coin', {id:${team.id}, amount:3})">+3</button>
                            <button class="hud-ctrl-btn btn-plus" onclick="app.action('coin', {id:${team.id}, amount:5})">+5</button>
                            
                            <button class="hud-ctrl-btn btn-minus" onclick="app.action('coin', {id:${team.id}, amount:-1})">-1</button>
                            
                            <button class="hud-ctrl-btn btn-shop-row" onclick="app.openShop(${team.id})">ğŸ›’ ì•„ì´í…œ ìƒì </button>
                        </div>
                    `;
                    container.appendChild(div);
                });
            }
        };
    </script>
</body>
</html>